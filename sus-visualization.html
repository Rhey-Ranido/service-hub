<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Usability Scale (SUS) Score Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        .chart-container {
            position: relative;
            height: 600px;
            margin-bottom: 30px;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            justify-content: center;
            text-align: center;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .grade-f { background-color: #e74c3c; }
        .grade-d { background-color: #f39c12; }
        .grade-c { background-color: #f1c40f; }
        .grade-b { background-color: #2ecc71; }
        .grade-a { background-color: #27ae60; }
        .stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
            justify-items: center;
            align-items: stretch;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
            width: 100%;
            max-width: 200px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>System Usability Scale (SUS) Score Analysis</h1>
            <p>Users' SUS scores plotted against percentile ranks with letter grade classifications</p>
        </div>

        <div class="chart-container">
            <canvas id="susChart"></canvas>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color grade-f"></div>
                <div>
                    <strong>Grade F (0-35)</strong><br>
                    Very poor usability
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color grade-d"></div>
                <div>
                    <strong>Grade D (35-50)</strong><br>
                    Below-average usability
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color grade-c"></div>
                <div>
                    <strong>Grade C (50-70)</strong><br>
                    Average/acceptable usability
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color grade-b"></div>
                <div>
                    <strong>Grade B (70-85)</strong><br>
                    Good usability
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-color grade-a"></div>
                <div>
                    <strong>Grade A (85+)</strong><br>
                    Excellent usability
                </div>
            </div>
        </div>

        <div class="stats" id="statistics">
            <!-- Statistics will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // SUS Data (imported from your SUS.js file)
        const susData = [
            [4, 1, 5, 1, 4, 2, 5, 1, 2, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [1, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 2, 3, 5, 5, 2, 5, 2, 5, 2],
            [5, 1, 5, 5, 5, 1, 5, 3, 5, 2],
            [4, 1, 5, 1, 4, 2, 5, 1, 2, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [3, 1, 3, 1, 5, 1, 5, 3, 5, 1],
            [5, 5, 5, 5, 5, 5, 4, 5, 5, 5],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 2, 3, 5, 5, 2, 5, 2, 5, 2],
            [5, 1, 5, 5, 5, 1, 5, 3, 5, 2],
            [5, 1, 3, 1, 5, 1, 5, 3, 5, 1],
            [4, 1, 3, 1, 5, 1, 3, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [3, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 3, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 3, 1, 5, 1],
            [5, 3, 3, 1, 5, 1, 5, 3, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [3, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 3, 3, 1, 5, 1, 2, 3, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 3, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 3, 3, 1, 5, 1, 4, 3, 5, 1],
            [5, 3, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 3, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 3, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [4, 1, 5, 1, 4, 2, 5, 1, 2, 1],
            [5, 1, 3, 1, 5, 1, 2, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 4, 5, 1],
            [5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [4, 1, 5, 1, 4, 2, 3, 4, 2, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            [5, 1, 3, 1, 5, 1, 5, 4, 5, 1],
            [4, 1, 5, 1, 4, 2, 5, 1, 2, 1],
            [5, 1, 3, 1, 5, 1, 4, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            [5, 1, 3, 1, 5, 1, 5, 4, 5, 1],
            [4, 1, 5, 1, 4, 2, 5, 1, 2, 1],
            [5, 1, 3, 1, 5, 1, 5, 1, 5, 1],
            [5, 1, 3, 1, 5, 1, 4, 3, 5, 1],
            [5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
        ];

        // SUS Calculation Functions
        function calculateSUSScore(responses) {
            if (!Array.isArray(responses) || responses.length !== 10) {
                throw new Error('Responses must be an array of exactly 10 values');
            }

            let totalScore = 0;

            for (let i = 0; i < 10; i++) {
                const response = responses[i];
                
                if (response < 1 || response > 5) {
                    throw new Error(`Response ${i + 1} must be between 1 and 5, got ${response}`);
                }

                if (i % 2 === 0) {
                    // Odd-numbered questions (index 0, 2, 4, 6, 8 = questions 1, 3, 5, 7, 9)
                    totalScore += response - 1;
                } else {
                    // Even-numbered questions (index 1, 3, 5, 7, 9 = questions 2, 4, 6, 8, 10)
                    totalScore += 5 - response;
                }
            }

            return totalScore * 2.5;
        }

        function getLetterGrade(score) {
            if (score >= 85) return 'A';
            if (score >= 70) return 'B';
            if (score >= 50) return 'C';
            if (score >= 35) return 'D';
            return 'F';
        }

        function getGradeColor(grade) {
            switch(grade) {
                case 'A': return '#27ae60';
                case 'B': return '#2ecc71';
                case 'C': return '#f1c40f';
                case 'D': return '#f39c12';
                case 'F': return '#e74c3c';
                default: return '#95a5a6';
            }
        }

        // Calculate SUS scores and percentiles
        const susScores = susData.map(responses => calculateSUSScore(responses));
        const sortedScores = [...susScores].sort((a, b) => a - b);

        // Calculate percentile rank for each score
        function calculatePercentileRank(score, allScores) {
            const belowCount = allScores.filter(s => s < score).length;
            const equalCount = allScores.filter(s => s === score).length;
            return ((belowCount + (equalCount - 1) / 2) / allScores.length) * 100;
        }

        // Prepare data for visualization
        const chartData = susScores.map((score, index) => ({
            x: score,
            y: calculatePercentileRank(score, susScores),
            grade: getLetterGrade(score),
            responseIndex: index + 1
        }));

        // Group data by letter grade for different colors
        const gradeGroups = {
            'A': chartData.filter(d => d.grade === 'A'),
            'B': chartData.filter(d => d.grade === 'B'),
            'C': chartData.filter(d => d.grade === 'C'),
            'D': chartData.filter(d => d.grade === 'D'),
            'F': chartData.filter(d => d.grade === 'F')
        };

        // Initialize Chart
        const ctx = document.getElementById('susChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Grade A (85+) - Excellent',
                        data: gradeGroups.A,
                        backgroundColor: '#27ae60',
                        borderColor: '#27ae60',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Grade B (70-85) - Good',
                        data: gradeGroups.B,
                        backgroundColor: '#2ecc71',
                        borderColor: '#2ecc71',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Grade C (50-70) - Average',
                        data: gradeGroups.C,
                        backgroundColor: '#f1c40f',
                        borderColor: '#f1c40f',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Grade D (35-50) - Below Average',
                        data: gradeGroups.D,
                        backgroundColor: '#f39c12',
                        borderColor: '#f39c12',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    },
                    {
                        label: 'Grade F (0-35) - Very Poor',
                        data: gradeGroups.F,
                        backgroundColor: '#e74c3c',
                        borderColor: '#e74c3c',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'SUS Scores vs Percentile Ranks',
                        font: {
                            size: 18,
                            weight: 'bold'
                        },
                        padding: 20
                    },
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15
                        }
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                const point = context[0];
                                return `Response #${point.raw.responseIndex}`;
                            },
                            label: function(context) {
                                const point = context.raw;
                                return [
                                    `SUS Score: ${point.x}`,
                                    `Percentile: ${point.y.toFixed(1)}%`,
                                    `Grade: ${point.grade}`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: {
                            display: true,
                            text: 'SUS Score',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 100,
                        ticks: {
                            stepSize: 10
                        },
                        grid: {
                            display: true,
                            color: '#e0e0e0'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Percentile Rank (%)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 100,
                        ticks: {
                            stepSize: 10
                        },
                        grid: {
                            display: true,
                            color: '#e0e0e0'
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'point'
                }
            }
        });

        // Add vertical lines for grade boundaries
        const gradeLines = [
            { value: 35, color: '#e74c3c', label: 'F/D' },
            { value: 50, color: '#f39c12', label: 'D/C' },
            { value: 70, color: '#f1c40f', label: 'C/B' },
            { value: 85, color: '#2ecc71', label: 'B/A' }
        ];

        // Add grade boundary lines and connecting progression lines
        Chart.register({
            id: 'gradeBoundariesAndConnections',
            afterDraw: function(chart) {
                const ctx = chart.ctx;
                const chartArea = chart.chartArea;
                
                ctx.save();
                
                // Draw vertical grade boundary lines
                ctx.strokeStyle = '#bdc3c7';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                
                gradeLines.forEach(line => {
                    const x = chart.scales.x.getPixelForValue(line.value);
                    ctx.beginPath();
                    ctx.moveTo(x, chartArea.top);
                    ctx.lineTo(x, chartArea.bottom);
                    ctx.stroke();
                    
                    // Add label
                    ctx.fillStyle = line.color;
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(line.label, x, chartArea.top - 5);
                });
                
                // Draw horizontal connecting lines between grades
                ctx.setLineDash([10, 5]);
                ctx.strokeStyle = '#7f8c8d';
                ctx.lineWidth = 2;
                
                // Define grade center points and percentile positions
                const gradeConnections = [
                    { score: 17.5, grade: 'F', color: '#e74c3c' },  // F center (0-35)
                    { score: 42.5, grade: 'D', color: '#f39c12' },  // D center (35-50)
                    { score: 60, grade: 'C', color: '#f1c40f' },    // C center (50-70)
                    { score: 77.5, grade: 'B', color: '#2ecc71' },  // B center (70-85)
                    { score: 92.5, grade: 'A', color: '#27ae60' }   // A center (85-100)
                ];
                
                // Calculate average percentile for each grade
                const gradePercentiles = {};
                gradeConnections.forEach(grade => {
                    const gradeScores = chartData.filter(d => d.grade === grade.grade);
                    if (gradeScores.length > 0) {
                        const avgPercentile = gradeScores.reduce((sum, d) => sum + d.y, 0) / gradeScores.length;
                        gradePercentiles[grade.grade] = avgPercentile;
                    } else {
                        // Use theoretical percentile if no data points
                        gradePercentiles[grade.grade] = (grade.score / 100) * 100;
                    }
                });
                
                // Draw connecting lines between consecutive grades
                for (let i = 0; i < gradeConnections.length - 1; i++) {
                    const currentGrade = gradeConnections[i];
                    const nextGrade = gradeConnections[i + 1];
                    
                    const x1 = chart.scales.x.getPixelForValue(currentGrade.score);
                    const y1 = chart.scales.y.getPixelForValue(gradePercentiles[currentGrade.grade] || 20 + i * 20);
                    const x2 = chart.scales.x.getPixelForValue(nextGrade.score);
                    const y2 = chart.scales.y.getPixelForValue(gradePercentiles[nextGrade.grade] || 20 + (i + 1) * 20);
                    
                    // Create gradient for the connecting line
                    const gradient = ctx.createLinearGradient(x1, y1, x2, y2);
                    gradient.addColorStop(0, currentGrade.color);
                    gradient.addColorStop(1, nextGrade.color);
                    
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = 3;
                    ctx.setLineDash([8, 4]);
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                    
                    // Add grade labels at connection points
                    ctx.fillStyle = currentGrade.color;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(currentGrade.grade, x1, y1 - 10);
                    
                    // Add the last grade label
                    if (i === gradeConnections.length - 2) {
                        ctx.fillStyle = nextGrade.color;
                        ctx.fillText(nextGrade.grade, x2, y2 - 10);
                    }
                }
                
                // Add connecting arrows
                ctx.setLineDash([]);
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 2;
                
                for (let i = 0; i < gradeConnections.length - 1; i++) {
                    const currentGrade = gradeConnections[i];
                    const nextGrade = gradeConnections[i + 1];
                    
                    const x1 = chart.scales.x.getPixelForValue(currentGrade.score);
                    const y1 = chart.scales.y.getPixelForValue(gradePercentiles[currentGrade.grade] || 20 + i * 20);
                    const x2 = chart.scales.x.getPixelForValue(nextGrade.score);
                    const y2 = chart.scales.y.getPixelForValue(gradePercentiles[nextGrade.grade] || 20 + (i + 1) * 20);
                    
                    // Draw arrow head
                    const angle = Math.atan2(y2 - y1, x2 - x1);
                    const arrowLength = 8;
                    
                    ctx.beginPath();
                    ctx.moveTo(x2, y2);
                    ctx.lineTo(
                        x2 - arrowLength * Math.cos(angle - Math.PI / 6),
                        y2 - arrowLength * Math.sin(angle - Math.PI / 6)
                    );
                    ctx.moveTo(x2, y2);
                    ctx.lineTo(
                        x2 - arrowLength * Math.cos(angle + Math.PI / 6),
                        y2 - arrowLength * Math.sin(angle + Math.PI / 6)
                    );
                    ctx.stroke();
                }
                
                ctx.restore();
            }
        });

        // Calculate and display statistics
        function displayStatistics() {
            const scores = susScores;
            const average = scores.reduce((sum, score) => sum + score, 0) / scores.length;
            const median = sortedScores[Math.floor(sortedScores.length / 2)];
            const min = Math.min(...scores);
            const max = Math.max(...scores);
            
            const gradeDistribution = {
                'A': scores.filter(s => s >= 85).length,
                'B': scores.filter(s => s >= 70 && s < 85).length,
                'C': scores.filter(s => s >= 50 && s < 70).length,
                'D': scores.filter(s => s >= 35 && s < 50).length,
                'F': scores.filter(s => s < 35).length
            };

            const statsContainer = document.getElementById('statistics');
            statsContainer.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${scores.length}</div>
                    <div class="stat-label">Total Responses</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${average.toFixed(1)}</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${median}</div>
                    <div class="stat-label">Median Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${min} - ${max}</div>
                    <div class="stat-label">Score Range</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${gradeDistribution.A}</div>
                    <div class="stat-label">Grade A (Excellent)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${gradeDistribution.B}</div>
                    <div class="stat-label">Grade B (Good)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${gradeDistribution.C}</div>
                    <div class="stat-label">Grade C (Average)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${gradeDistribution.D}</div>
                    <div class="stat-label">Grade D (Below Avg)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${gradeDistribution.F}</div>
                    <div class="stat-label">Grade F (Very Poor)</div>
                </div>
            `;
        }

        // Display statistics when page loads
        displayStatistics();

        // Add click handler for detailed analysis
        chart.canvas.onclick = function(evt) {
            const points = chart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length) {
                const firstPoint = points[0];
                const datasetIndex = firstPoint.datasetIndex;
                const index = firstPoint.index;
                const dataPoint = chart.data.datasets[datasetIndex].data[index];
                
                alert(`Response #${dataPoint.responseIndex}:\nSUS Score: ${dataPoint.x}\nPercentile: ${dataPoint.y.toFixed(1)}%\nGrade: ${dataPoint.grade}`);
            }
        };
    </script>
</body>
</html>
